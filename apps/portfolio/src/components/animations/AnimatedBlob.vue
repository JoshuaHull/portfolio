<template>
<svg
  tabindex="0"
  :class="`animated-blob ${isHovering ? 'hovering' : ''}`"
  viewBox="0 0 200 200"
  xmlns="http://www.w3.org/2000/svg"
  :aria-label="`blob-${colour}`"
  @mouseenter="handleHover"
  :style="`
    --animated-blob-path-idle: '${blobs[actualIdleBlobIdx]}';
    --animated-blob-path-active: '${blobs[activeBlobIdx]}';
  `"
>
  <path :fill="colour" transform="translate(90 90)" />
</svg>
</template>

<script setup lang="ts">
import { useVanishingValue } from "use-vanishing-value";

const blobs = [
  "M0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0C0,0,0,0,0,0Z",
  "M25.8,-31.3C36.2,-27.9,49.3,-24.1,58.9,-14.5C68.5,-4.8,74.6,10.7,65.9,16.5C57.2,22.3,33.8,18.3,20.4,28.5C7,38.7,3.5,63.1,-6.5,72C-16.4,80.8,-32.8,74.3,-37,61.1C-41.1,47.9,-33.1,28,-34.1,13.7C-35.2,-0.6,-45.4,-9.3,-47.8,-19.7C-50.2,-30.1,-44.7,-42.1,-35.5,-45.8C-26.2,-49.5,-13.1,-45,-2.7,-41.2C7.7,-37.5,15.4,-34.6,25.8,-31.3Z",
  "M38.5,-51.7C48.6,-45.6,54.6,-32.6,55.5,-20.3C56.4,-7.9,52.1,3.8,47.8,15C43.5,26.3,39,36.9,31.1,35.6C23.1,34.3,11.5,21,0,21C-11.5,21,-23,34.2,-31.6,35.7C-40.3,37.3,-46.2,27.1,-55.2,14.4C-64.3,1.6,-76.6,-13.6,-73.2,-23.7C-69.8,-33.8,-50.8,-38.7,-36,-43.3C-21.2,-47.9,-10.6,-52,1.8,-54.5C14.2,-57,28.4,-57.8,38.5,-51.7Z",
  "M31.5,-45.9C37,-39.4,34.9,-25,32.6,-14.7C30.3,-4.4,27.7,1.9,26.8,10C25.9,18.1,26.7,27.9,22.5,36.3C18.3,44.6,9.2,51.4,1.3,49.6C-6.5,47.8,-13.1,37.4,-24.3,31.4C-35.6,25.3,-51.5,23.6,-58.2,15.9C-65,8.1,-62.6,-5.7,-51.9,-10.2C-41.3,-14.7,-22.4,-9.8,-12.4,-14.8C-2.4,-19.9,-1.2,-34.8,5.9,-43C13,-51.1,26,-52.4,31.5,-45.9Z",
  "M39.3,-45.5C49.8,-46.6,56.2,-33.5,59.8,-20C63.4,-6.5,64.1,7.3,62.5,22.7C60.8,38.2,56.7,55.3,45.9,63.2C35.1,71.2,17.5,69.9,4.4,63.8C-8.8,57.8,-17.6,47.1,-30.7,39.9C-43.8,32.7,-61.2,29.2,-71.6,18.3C-82,7.4,-85.3,-10.7,-77.6,-22.4C-69.8,-34,-51.1,-39.3,-36.3,-36.8C-21.6,-34.4,-10.8,-24.2,1.8,-26.7C14.5,-29.2,28.9,-44.4,39.3,-45.5Z",
  "M40.3,-65.9C43.5,-53.1,31.3,-29.7,23.6,-16.4C15.9,-3.1,12.7,0,15.9,9.8C19.1,19.6,28.7,36.2,27.1,50.5C25.5,64.8,12.8,76.8,2.1,74C-8.6,71.1,-17.2,53.4,-17.6,38.7C-18.1,24,-10.3,12.4,-11.8,4.6C-13.4,-3.3,-24.3,-7.4,-31.8,-18.4C-39.3,-29.3,-43.3,-47.2,-37.4,-59.1C-31.5,-70.9,-15.8,-76.7,1.4,-78.6C18.5,-80.6,37.1,-78.6,40.3,-65.9Z",
  "M29,-43.5C33.7,-36.6,30.9,-22.9,29.7,-12.9C28.4,-3,28.7,3.2,30.1,13.2C31.5,23.1,34.1,36.9,29.3,42.8C24.5,48.8,12.2,47,5,40.2C-2.3,33.3,-4.6,21.4,-16.1,17.6C-27.5,13.8,-48.2,18.1,-54.2,14.1C-60.3,10.2,-51.7,-1.9,-48.7,-17.3C-45.7,-32.6,-48.2,-51.1,-41,-57.3C-33.8,-63.4,-16.9,-57.2,-2.4,-53.9C12.2,-50.7,24.4,-50.5,29,-43.5Z",
  "M44.2,-60.9C58.7,-50.4,72.8,-39.3,76.2,-25.5C79.7,-11.7,72.5,4.7,66.3,20.8C60.1,36.9,54.8,52.5,43.9,51.1C33,49.7,16.5,31.3,1.5,29.2C-13.5,27.1,-26.9,41.3,-41.4,43.9C-55.9,46.5,-71.3,37.3,-69.5,26.5C-67.7,15.6,-48.6,3,-38.6,-7.9C-28.6,-18.8,-27.8,-28,-22.9,-41.7C-18,-55.4,-9,-73.6,2.9,-77.6C14.9,-81.7,29.7,-71.5,44.2,-60.9Z",
  "M20.4,-27.5C31.1,-20.4,47.4,-20.6,49.5,-15.7C51.7,-10.8,39.6,-0.9,33.4,8.6C27.2,18.2,26.9,27.4,22.3,38.1C17.7,48.8,8.9,60.9,3.5,56.1C-1.9,51.3,-3.7,29.5,-15.4,21.1C-27.1,12.7,-48.6,17.7,-60.6,12.2C-72.7,6.7,-75.3,-9.3,-71.5,-23.9C-67.7,-38.5,-57.4,-51.6,-44.4,-57.9C-31.4,-64.3,-15.7,-63.8,-5.4,-56.3C4.9,-48.9,9.8,-34.6,20.4,-27.5Z",
  "M21.5,-34.2C29.9,-23.6,39.9,-19.9,49.7,-11.1C59.4,-2.3,68.9,11.6,69,25.9C69.1,40.2,59.8,54.9,46.8,65.6C33.7,76.4,16.9,83.2,5.7,75.4C-5.5,67.6,-11.1,45.2,-22.9,34.1C-34.7,22.9,-52.8,23,-57,16.9C-61.3,10.7,-51.9,-1.5,-45.2,-12.4C-38.5,-23.3,-34.6,-32.8,-27.6,-43.9C-20.5,-54.9,-10.3,-67.5,-1.8,-64.9C6.6,-62.4,13.2,-44.8,21.5,-34.2Z",
  "M52.7,-64.1C68,-61.5,79.8,-45.6,85.4,-27.9C91,-10.1,90.4,9.5,75.6,15.1C60.8,20.8,31.8,12.3,16.9,8.7C1.9,5.2,1,6.4,-3.2,10.7C-7.3,15.1,-14.6,22.6,-22,23.7C-29.4,24.9,-36.9,19.7,-38.4,13C-39.8,6.3,-35.1,-1.8,-29.5,-6.6C-23.9,-11.5,-17.3,-13.1,-12.2,-19C-7.1,-25,-3.6,-35.2,7.6,-45.6C18.7,-56.1,37.5,-66.7,52.7,-64.1Z",
  "M38.9,-45.5C51.3,-44.6,62.7,-34.3,70.5,-20.5C78.2,-6.7,82.4,10.7,77.4,24.8C72.4,38.9,58.1,49.6,43.7,45.7C29.2,41.7,14.6,23,5.1,16C-4.5,9,-8.9,13.7,-24.3,18C-39.7,22.3,-66.1,26.2,-69.6,21.3C-73,16.3,-53.6,2.6,-45.9,-13.1C-38.3,-28.8,-42.4,-46.5,-36.7,-49.5C-31.1,-52.5,-15.5,-40.9,-1.1,-39.4C13.3,-37.8,26.6,-46.4,38.9,-45.5Z",
  "M35.9,-62.4C36.7,-48.8,20.8,-25.2,13.2,-12.7C5.6,-0.3,6.3,1,13.3,12C20.3,23,33.6,43.8,32.4,53.5C31.2,63.2,15.6,61.9,6,53.6C-3.6,45.3,-7.1,30,-11.3,21.3C-15.4,12.5,-20.2,10.3,-27.9,4.8C-35.6,-0.8,-46.2,-9.6,-42.6,-11.7C-39,-13.9,-21.2,-9.3,-11.8,-20.1C-2.3,-30.8,-1.1,-56.9,8.2,-68.2C17.5,-79.5,35.1,-75.9,35.9,-62.4Z",
  "M28.1,-43.3C31.1,-36.4,24.8,-21.2,33,-7.9C41.2,5.4,64,16.8,68.3,28C72.6,39.2,58.5,50.1,44.1,60C29.6,69.9,14.8,78.7,6.4,69.8C-1.9,60.9,-3.8,34.4,-12.3,22.6C-20.8,10.8,-35.9,13.7,-48,8.1C-60.1,2.6,-69.1,-11.4,-60.9,-14.5C-52.6,-17.5,-26.9,-9.6,-13.9,-13.3C-0.8,-17,-0.4,-32.3,6,-40.6C12.5,-48.9,25,-50.2,28.1,-43.3Z",
  "M29.2,-47.7C30.5,-39.4,18.9,-20.9,25.6,-6.8C32.3,7.3,57.3,17,63.1,27.1C68.9,37.1,55.5,47.5,41.8,46.7C28,45.9,14,33.9,2.9,30C-8.3,26,-16.6,30.2,-23.1,28.6C-29.5,27.1,-34.1,19.8,-39.5,11C-44.8,2.2,-50.9,-8.2,-45.7,-12C-40.5,-15.8,-24,-13.1,-14.5,-18.8C-5,-24.5,-2.5,-38.6,5.8,-46.5C14,-54.4,28,-56.1,29.2,-47.7Z",
  "M38.8,-51.9C52.7,-43.3,68.1,-35.2,74.9,-22.4C81.7,-9.6,79.9,7.9,71.7,20.2C63.5,32.6,48.8,39.7,35.7,39.4C22.7,39.1,11.4,31.3,2.7,27.6C-5.9,23.8,-11.9,24.2,-17.8,22.2C-23.7,20.2,-29.7,15.9,-33.3,9.6C-36.9,3.4,-38.3,-4.7,-37.3,-13.5C-36.3,-22.2,-33,-31.6,-26.4,-42.6C-19.8,-53.5,-9.9,-66.1,1.3,-67.9C12.4,-69.6,24.9,-60.5,38.8,-51.9Z",
  "M48.1,-62.4C57.6,-59.4,57,-38.9,50,-24.7C43,-10.5,29.4,-2.7,21.4,2.3C13.4,7.4,11,9.6,8.4,24.3C5.7,38.9,2.9,66.1,-2.5,69.5C-7.8,72.9,-15.6,52.6,-22.4,39.2C-29.1,25.9,-34.8,19.5,-44.6,9.7C-54.4,-0.2,-68.3,-13.4,-63.6,-18.4C-58.8,-23.3,-35.4,-19.9,-21.7,-21.5C-8,-23.1,-4,-29.9,7.7,-40.4C19.4,-51,38.7,-65.5,48.1,-62.4Z",
];

interface AnimatedBlobProps {
  colour: string;
  left?: string;
  top?: string;
  rotation?: string;
}

const props = defineProps<AnimatedBlobProps>();
const {
  left,
  top,
  colour,
  rotation,
} = toRefs(props);

const [idleBlobIdx, activeBlobIdx] = getBlobIndices();

const actualLeft = computed(() => left?.value ?? "auto");
const actualTop = computed(() => top?.value ?? "auto");

const [isHovering, pushIsHovering] = useVanishingValue<boolean>(500);

const actualIdleBlobIdx = ref(0);

setTimeout(() => actualIdleBlobIdx.value = idleBlobIdx, 0);

function getBlobIndices(): [number, number] {
  const randomBlob = () => Math.floor(Math.random() * (blobs.length - 1)) + 1;
  const blobIdleIdx = randomBlob();
  const blobActiveIdx = (() => {
    for(;;) {
      const blob = randomBlob();

      if (blob !== blobIdleIdx)
        return blob;
    }
  })();

  return [blobIdleIdx, blobActiveIdx];
}

function handleHover() {
  pushIsHovering(true);
}
</script>

<style scoped>
.animated-blob {
  left: v-bind(actualLeft);
  top: v-bind(actualTop);
  transform: rotate(v-bind(rotation));
}

path {
  d: path(var(--animated-blob-path-idle));
}

.animated-blob.hovering path,
.animated-blob:hover path,
.animated-blob:focus path {
  d: path(var(--animated-blob-path-active));
}
</style>

<style>
.animated-blob path {
  transition: all 0.5s ease;
}

.animated-blob:focus,
.animated-blob:hover {
  cursor: pointer;
  outline: solid var(--color-outline) 2px;
  border-radius: 1rem;
}
</style>
